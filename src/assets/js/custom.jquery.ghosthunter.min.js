/**
* ghostHunter - 0.3.5
 * Copyright (C) 2014 Jamal Neufeld (jamal@i11u.me)
 * MIT Licensed
 * @license
*/
!function($){!function(){var t=function(e){var n=new t.Index;return n.pipeline.add(t.trimmer,t.stopWordFilter,t.stemmer),e&&e.call(n,n),n};t.version="0.7.0",t.utils={},t.utils.warn=function(t){return function(e){t.console&&console.warn&&console.warn(e)}}(this),t.utils.asString=function(t){return null==t?"":t.toString()},t.EventEmitter=function(){this.events={}},t.EventEmitter.prototype.addListener=function(){var t=Array.prototype.slice.call(arguments),e=t.pop(),n=t;if("function"!=typeof e)throw new TypeError("last argument must be a function");n.forEach((function(t){this.hasHandler(t)||(this.events[t]=[]),this.events[t].push(e)}),this)},t.EventEmitter.prototype.removeListener=function(t,e){if(this.hasHandler(t)){var n=this.events[t].indexOf(e);this.events[t].splice(n,1),this.events[t].length||delete this.events[t]}},t.EventEmitter.prototype.emit=function(t){if(this.hasHandler(t)){var e=Array.prototype.slice.call(arguments,1);this.events[t].forEach((function(t){t.apply(void 0,e)}))}},t.EventEmitter.prototype.hasHandler=function(t){return t in this.events},t.tokenizer=function(e){return arguments.length&&null!=e&&null!=e?Array.isArray(e)?e.map((function(e){return t.utils.asString(e).toLowerCase()})):e.toString().trim().toLowerCase().split(t.tokenizer.seperator):[]},t.tokenizer.seperator=/[\s\-]+/,t.tokenizer.load=function(t){var e=this.registeredFunctions[t];if(!e)throw new Error("Cannot load un-registered function: "+t);return e},t.tokenizer.label="default",t.tokenizer.registeredFunctions={default:t.tokenizer},t.tokenizer.registerFunction=function(e,n){n in this.registeredFunctions&&t.utils.warn("Overwriting existing tokenizer: "+n),e.label=n,this.registeredFunctions[n]=e},t.Pipeline=function(){this._stack=[]},t.Pipeline.registeredFunctions={},t.Pipeline.registerFunction=function(e,n){n in this.registeredFunctions&&t.utils.warn("Overwriting existing registered function: "+n),e.label=n,t.Pipeline.registeredFunctions[e.label]=e},t.Pipeline.warnIfFunctionNotRegistered=function(e){var n;e.label&&e.label in this.registeredFunctions||t.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",e)},t.Pipeline.load=function(e){var n=new t.Pipeline;return e.forEach((function(e){var i=t.Pipeline.registeredFunctions[e];if(!i)throw new Error("Cannot load un-registered function: "+e);n.add(i)})),n},t.Pipeline.prototype.add=function(){var e=Array.prototype.slice.call(arguments);e.forEach((function(e){t.Pipeline.warnIfFunctionNotRegistered(e),this._stack.push(e)}),this)},t.Pipeline.prototype.after=function(e,n){t.Pipeline.warnIfFunctionNotRegistered(n);var i=this._stack.indexOf(e);if(-1==i)throw new Error("Cannot find existingFn");i+=1,this._stack.splice(i,0,n)},t.Pipeline.prototype.before=function(e,n){t.Pipeline.warnIfFunctionNotRegistered(n);var i=this._stack.indexOf(e);if(-1==i)throw new Error("Cannot find existingFn");this._stack.splice(i,0,n)},t.Pipeline.prototype.remove=function(t){var e=this._stack.indexOf(t);-1!=e&&this._stack.splice(e,1)},t.Pipeline.prototype.run=function(t){for(var e=[],n=t.length,i=this._stack.length,r=0;n>r;r++){for(var o=t[r],s=0;i>s&&(void 0!==(o=this._stack[s](o,r,t))&&""!==o);s++);void 0!==o&&""!==o&&e.push(o)}return e},t.Pipeline.prototype.reset=function(){this._stack=[]},t.Pipeline.prototype.toJSON=function(){return this._stack.map((function(e){return t.Pipeline.warnIfFunctionNotRegistered(e),e.label}))},t.Vector=function(){this._magnitude=null,this.list=void 0,this.length=0},t.Vector.Node=function(t,e,n){this.idx=t,this.val=e,this.next=n},t.Vector.prototype.insert=function(e,n){this._magnitude=void 0;var i=this.list;if(!i)return this.list=new t.Vector.Node(e,n,i),this.length++;if(e<i.idx)return this.list=new t.Vector.Node(e,n,i),this.length++;for(var r=i,o=i.next;null!=o;){if(e<o.idx)return r.next=new t.Vector.Node(e,n,o),this.length++;r=o,o=o.next}return r.next=new t.Vector.Node(e,n,o),this.length++},t.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var t,e=this.list,n=0;e;)n+=(t=e.val)*t,e=e.next;return this._magnitude=Math.sqrt(n)},t.Vector.prototype.dot=function(t){for(var e=this.list,n=t.list,i=0;e&&n;)e.idx<n.idx?e=e.next:e.idx>n.idx?n=n.next:(i+=e.val*n.val,e=e.next,n=n.next);return i},t.Vector.prototype.similarity=function(t){return this.dot(t)/(this.magnitude()*t.magnitude())},t.SortedSet=function(){this.length=0,this.elements=[]},t.SortedSet.load=function(t){var e=new this;return e.elements=t,e.length=t.length,e},t.SortedSet.prototype.add=function(){var t,e;for(t=0;t<arguments.length;t++)e=arguments[t],~this.indexOf(e)||this.elements.splice(this.locationFor(e),0,e);this.length=this.elements.length},t.SortedSet.prototype.toArray=function(){return this.elements.slice()},t.SortedSet.prototype.map=function(t,e){return this.elements.map(t,e)},t.SortedSet.prototype.forEach=function(t,e){return this.elements.forEach(t,e)},t.SortedSet.prototype.indexOf=function(t){for(var e=0,n=this.elements.length,i=n-e,r=e+Math.floor(i/2),o=this.elements[r];i>1;){if(o===t)return r;t>o&&(e=r),o>t&&(n=r),i=n-e,r=e+Math.floor(i/2),o=this.elements[r]}return o===t?r:-1},t.SortedSet.prototype.locationFor=function(t){for(var e=0,n=this.elements.length,i=n-e,r=e+Math.floor(i/2),o=this.elements[r];i>1;)t>o&&(e=r),o>t&&(n=r),i=n-e,r=e+Math.floor(i/2),o=this.elements[r];return o>t?r:t>o?r+1:void 0},t.SortedSet.prototype.intersect=function(e){for(var n=new t.SortedSet,i=0,r=0,o=this.length,s=e.length,a=this.elements,h=e.elements;!(i>o-1||r>s-1);)a[i]!==h[r]?a[i]<h[r]?i++:a[i]>h[r]&&r++:(n.add(a[i]),i++,r++);return n},t.SortedSet.prototype.clone=function(){var e=new t.SortedSet;return e.elements=this.toArray(),e.length=e.elements.length,e},t.SortedSet.prototype.union=function(t){var e,n,i;this.length>=t.length?(e=this,n=t):(e=t,n=this),i=e.clone();for(var r=0,o=n.toArray();r<o.length;r++)i.add(o[r]);return i},t.SortedSet.prototype.toJSON=function(){return this.toArray()},t.Index=function(){this._fields=[],this._ref="id",this.pipeline=new t.Pipeline,this.documentStore=new t.Store,this.tokenStore=new t.TokenStore,this.corpusTokens=new t.SortedSet,this.eventEmitter=new t.EventEmitter,this.tokenizerFn=t.tokenizer,this._idfCache={},this.on("add","remove","update",function(){this._idfCache={}}.bind(this))},t.Index.prototype.on=function(){var t=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,t)},t.Index.prototype.off=function(t,e){return this.eventEmitter.removeListener(t,e)},t.Index.load=function(e){e.version!==t.version&&t.utils.warn("version mismatch: current "+t.version+" importing "+e.version);var n=new this;return n._fields=e.fields,n._ref=e.ref,n.tokenizer=t.tokenizer.load(e.tokenizer),n.documentStore=t.Store.load(e.documentStore),n.tokenStore=t.TokenStore.load(e.tokenStore),n.corpusTokens=t.SortedSet.load(e.corpusTokens),n.pipeline=t.Pipeline.load(e.pipeline),n},t.Index.prototype.field=function(t,e){var e,n={name:t,boost:(e=e||{}).boost||1};return this._fields.push(n),this},t.Index.prototype.ref=function(t){return this._ref=t,this},t.Index.prototype.tokenizer=function(e){var n;return e.label&&e.label in t.tokenizer.registeredFunctions||t.utils.warn("Function is not a registered tokenizer. This may cause problems when serialising the index"),this.tokenizerFn=e,this},t.Index.prototype.add=function(e,n){var i={},r=new t.SortedSet,o=e[this._ref],n=void 0===n||n;this._fields.forEach((function(t){var n=this.pipeline.run(this.tokenizerFn(e[t.name]));i[t.name]=n;for(var o=0;o<n.length;o++){var s=n[o];r.add(s),this.corpusTokens.add(s)}}),this),this.documentStore.set(o,r);for(var s=0;s<r.length;s++){for(var a=r.elements[s],h=0,u=0;u<this._fields.length;u++){var l=this._fields[u],c=i[l.name],f=c.length;if(f){for(var d=0,p=0;f>p;p++)c[p]===a&&d++;h+=d/f*l.boost}}this.tokenStore.add(a,{ref:o,tf:h})}n&&this.eventEmitter.emit("add",e,this)},t.Index.prototype.remove=function(t,e){var n=t[this._ref],e=void 0===e||e;if(this.documentStore.has(n)){var i=this.documentStore.get(n);this.documentStore.remove(n),i.forEach((function(t){this.tokenStore.remove(t,n)}),this),e&&this.eventEmitter.emit("remove",t,this)}},t.Index.prototype.update=function(t,e){var e=void 0===e||e;this.remove(t,!1),this.add(t,!1),e&&this.eventEmitter.emit("update",t,this)},t.Index.prototype.idf=function(t){var e="@"+t;if(Object.prototype.hasOwnProperty.call(this._idfCache,e))return this._idfCache[e];var n=this.tokenStore.count(t),i=1;return n>0&&(i=1+Math.log(this.documentStore.length/n)),this._idfCache[e]=i},t.Index.prototype.search=function(e){var n=this.pipeline.run(this.tokenizerFn(e)),i=new t.Vector,r=[],o=this._fields.reduce((function(t,e){return t+e.boost}),0),s,a;return n.some((function(t){return this.tokenStore.has(t)}),this)?(n.forEach((function(e,n,s){var a=1/s.length*this._fields.length*o,h=this,u=this.tokenStore.expand(e).reduce((function(n,r){var o=h.corpusTokens.indexOf(r),s=h.idf(r),u=1,l=new t.SortedSet;if(r!==e){var c=Math.max(3,r.length-e.length);u=1/Math.log(c)}o>-1&&i.insert(o,a*s*u);for(var f=h.tokenStore.get(r),d=Object.keys(f),p=d.length,v=0;p>v;v++)l.add(f[d[v]].ref);return n.union(l)}),new t.SortedSet);r.push(u)}),this),r.reduce((function(t,e){return t.intersect(e)})).map((function(t){return{ref:t,score:i.similarity(this.documentVector(t))}}),this).sort((function(t,e){return e.score-t.score}))):[]},t.Index.prototype.documentVector=function(e){for(var n=this.documentStore.get(e),i=n.length,r=new t.Vector,o=0;i>o;o++){var s=n.elements[o],a=this.tokenStore.get(s)[e].tf,h=this.idf(s);r.insert(this.corpusTokens.indexOf(s),a*h)}return r},t.Index.prototype.toJSON=function(){return{version:t.version,fields:this._fields,ref:this._ref,tokenizer:this.tokenizerFn.label,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}},t.Index.prototype.use=function(t){var e=Array.prototype.slice.call(arguments,1);e.unshift(this),t.apply(this,e)},t.Store=function(){this.store={},this.length=0},t.Store.load=function(e){var n=new this;return n.length=e.length,n.store=Object.keys(e.store).reduce((function(n,i){return n[i]=t.SortedSet.load(e.store[i]),n}),{}),n},t.Store.prototype.set=function(t,e){this.has(t)||this.length++,this.store[t]=e},t.Store.prototype.get=function(t){return this.store[t]},t.Store.prototype.has=function(t){return t in this.store},t.Store.prototype.remove=function(t){this.has(t)&&(delete this.store[t],this.length--)},t.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}},t.stemmer=function(){var t={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},e={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},n,i="[aeiouy]",r="[^aeiou]"+"[^aeiouy]*",o=i+"[aeiou]*",s,a="^("+r+")?"+o+r+"("+o+")?$",h="^("+r+")?"+o+r+o+r,u="^("+r+")?"+i,l=new RegExp("^("+r+")?"+o+r),c=new RegExp(h),f=new RegExp(a),d=new RegExp(u),p=/^(.+?)(ss|i)es$/,v=/^(.+?)([^s])s$/,g=/^(.+?)eed$/,m=/^(.+?)(ed|ing)$/,y=/.$/,S=/(at|bl|iz)$/,w=new RegExp("([^aeiouylsz])\\1$"),k=new RegExp("^"+r+i+"[^aeiouwxy]$"),x=/^(.+?[^aeiou])y$/,b=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,E=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,F=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,_=/^(.+?)(s|t)(ion)$/,z=/^(.+?)e$/,O=/ll$/,P=new RegExp("^"+r+i+"[^aeiouwxy]$"),T;return function(n){var i,r,o,s,a,h,u,T,T,T,T,T;if(n.length<3)return n;if("y"==(o=n.substr(0,1))&&(n=o.toUpperCase()+n.substr(1)),a=v,(s=p).test(n)?n=n.replace(s,"$1$2"):a.test(n)&&(n=n.replace(a,"$1$2")),a=m,(s=g).test(n)){var T=s.exec(n);(s=l).test(T[1])&&(s=y,n=n.replace(s,""))}else if(a.test(n)){var T;i=(T=a.exec(n))[1],(a=d).test(i)&&(h=w,u=k,(a=S).test(n=i)?n+="e":h.test(n)?(s=y,n=n.replace(s,"")):u.test(n)&&(n+="e"))}(s=x).test(n)&&(n=(i=(T=s.exec(n))[1])+"i");(s=b).test(n)&&(i=(T=s.exec(n))[1],r=T[2],(s=l).test(i)&&(n=i+t[r]));(s=E).test(n)&&(i=(T=s.exec(n))[1],r=T[2],(s=l).test(i)&&(n=i+e[r]));if(a=_,(s=F).test(n))i=(T=s.exec(n))[1],(s=c).test(i)&&(n=i);else if(a.test(n)){var T;i=(T=a.exec(n))[1]+T[2],(a=c).test(i)&&(n=i)}(s=z).test(n)&&(i=(T=s.exec(n))[1],a=f,h=P,((s=c).test(i)||a.test(i)&&!h.test(i))&&(n=i));return a=c,(s=O).test(n)&&a.test(n)&&(s=y,n=n.replace(s,"")),"y"==o&&(n=o.toLowerCase()+n.substr(1)),n}}(),t.Pipeline.registerFunction(t.stemmer,"stemmer"),t.generateStopWordFilter=function(t){var e=t.reduce((function(t,e){return t[e]=e,t}),{});return function(t){return t&&e[t]!==t?t:void 0}},t.stopWordFilter=t.generateStopWordFilter(["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]),t.Pipeline.registerFunction(t.stopWordFilter,"stopWordFilter"),t.trimmer=function(t){return t.replace(/^\W+/,"").replace(/\W+$/,"")},t.Pipeline.registerFunction(t.trimmer,"trimmer"),t.TokenStore=function(){this.root={docs:{}},this.length=0},t.TokenStore.load=function(t){var e=new this;return e.root=t.root,e.length=t.length,e},t.TokenStore.prototype.add=function(t,e,n){var n=n||this.root,i=t.charAt(0),r=t.slice(1);return i in n||(n[i]={docs:{}}),0===r.length?(n[i].docs[e.ref]=e,void(this.length+=1)):this.add(r,e,n[i])},t.TokenStore.prototype.has=function(t){if(!t)return!1;for(var e=this.root,n=0;n<t.length;n++){if(!e[t.charAt(n)])return!1;e=e[t.charAt(n)]}return!0},t.TokenStore.prototype.getNode=function(t){if(!t)return{};for(var e=this.root,n=0;n<t.length;n++){if(!e[t.charAt(n)])return{};e=e[t.charAt(n)]}return e},t.TokenStore.prototype.get=function(t,e){return this.getNode(t,e).docs||{}},t.TokenStore.prototype.count=function(t,e){return Object.keys(this.get(t,e)).length},t.TokenStore.prototype.remove=function(t,e){if(t){for(var n=this.root,i=0;i<t.length;i++){if(!(t.charAt(i)in n))return;n=n[t.charAt(i)]}delete n.docs[e]}},t.TokenStore.prototype.expand=function(t,e){var n=this.getNode(t),i=n.docs||{},e=e||[];return Object.keys(i).length&&e.push(t),Object.keys(n).forEach((function(n){"docs"!==n&&e.concat(this.expand(t+n,e))}),this),e},t.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}},function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.lunr=e()}(this,(function(){return t}))}(),$.fn.ghostHunter=function(options){var opts=$.extend({},$.fn.ghostHunter.defaults,options);if(opts.results)return pluginMethods.init(this,opts),pluginMethods},$.fn.ghostHunter.defaults={resultsData:!1,onPageLoad:!1,onKeyUp:!1,result_template:"<a id='gh-{{ref}}' class='gh-search-item' href='{{link}}'><p><h2>{{title}}</h2><h4>{{prettyPubDate}}</h4></p></a>",info_template:"<p>Number of posts found: {{amount}}</p>",displaySearchInfo:!0,zeroResultsInfo:!0,before:!1,onComplete:!1,filterfields:!1,subpath:"",item_preprocessor:!1,indexing_start:!1,indexing_end:!1,includebodysearch:!1};var prettyDate=function(date){var d=new Date(date),monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];return d.getDate()+" "+monthNames[d.getMonth()]+" "+d.getFullYear()},getSubpathKey=function(str){return str.replace(/^\//,"").replace(/\//g,"-")},lastTimeoutID=null,settleIDs=function(){$(".gh-search-item").each((function(){var oldAttr,newAttr=this.getAttribute("id").replace(/^new-/,"");this.setAttribute("id",newAttr)}))},updateSearchList=function(listItems,apiData,steps){for(var i=0,ilen=steps.length;i<ilen;i++){var step=steps[i];if("delete"==step[0])listItems.eq(step[1]-1).remove();else{var lunrref=apiData[step[2]-1].ref,postData=this.blogData[lunrref],html=this.format(this.result_template,postData);if("substitute"===step[0])listItems.eq(step[1]-1).replaceWith(html);else if("insert"===step[0]){var pos;pos=0===step[1]?null:step[1]-1,listItems.eq(pos).after(html)}}}settleIDs()},grabAndIndex=function(){this.blogData={},this.latestPost=0;var ghost_root,url=(ghost_root_url||"/ghost/api/v2")+"/content/posts/?key="+ghosthunter_key+"&limit=all&include=tags",params={limit:"all",include:"tags"};this.includebodysearch?(params.formats=["plaintext"],url+="&formats=plaintext"):params.formats=[""];var me=this;$.get(url).done((function(data){var idxSrc=data.posts;me.index=lunr((function(){this.ref("id"),this.field("title"),this.field("description"),me.includebodysearch&&this.field("plaintext"),this.field("pubDate"),this.field("tag"),idxSrc.forEach((function(arrayItem){var itemDate,recordedDate;new Date(arrayItem.updated_at).getTime()>new Date(me.latestPost).getTime()&&(me.latestPost=arrayItem.updated_at);var tag_arr=arrayItem.tags.map((function(v){return v.name}));null==arrayItem.meta_description&&(arrayItem.meta_description="");var category=tag_arr.join(", ");category.length<1&&(category="undefined");var parsedData={id:String(arrayItem.id),title:String(arrayItem.title),description:String(arrayItem.custom_excerpt),pubDate:String(arrayItem.published_at),tag:category};me.includebodysearch&&(parsedData.plaintext=String(arrayItem.plaintext)),this.add(parsedData);var localUrl=me.subpath+arrayItem.url;me.blogData[arrayItem.id]={title:arrayItem.title,description:arrayItem.custom_excerpt,pubDate:prettyDate(parsedData.pubDate),link:localUrl,tags:tag_arr},me.item_preprocessor&&Object.assign(me.blogData[arrayItem.id],me.item_preprocessor(arrayItem))}),this)}));try{var subpathKey=getSubpathKey(me.subpath);localStorage.setItem("ghost_"+subpathKey+"_lunrIndex",JSON.stringify(me.index)),localStorage.setItem("ghost_"+subpathKey+"_blogData",JSON.stringify(me.blogData)),localStorage.setItem("ghost_"+subpathKey+"_latestPost",me.latestPost)}catch(e){console.warn("ghostHunter: save to localStorage failed: "+e)}me.indexing_end&&me.indexing_end(),me.isInit=!0}))},pluginMethods={isInit:!1,init:function(target,opts){var that=this;if(that.target=target,Object.assign(this,opts),opts.onPageLoad){function miam(){that.loadAPI()}window.setTimeout(miam,1)}else target.focus((function(){that.loadAPI()}));target.closest("form").submit((function(e){e.preventDefault(),that.find(target.val())})),opts.onKeyUp&&(target.keydown((function(event){if(13===event.which)return!1})),target.keyup((function(event){that.find(target.val())})))},loadAPI:function(){if(!this.isInit){this.indexing_start&&this.indexing_start();try{var subpathKey=getSubpathKey(this.subpath);this.index=localStorage.getItem("ghost_"+subpathKey+"_lunrIndex"),this.blogData=localStorage.getItem("ghost_"+subpathKey+"_blogData"),this.latestPost=localStorage.getItem("ghost_"+subpathKey+"_latestPost"),this.latestPost&&this.index&&this.blogData&&(this.latestPost=this.latestPost,this.index=lunr.Index.load(JSON.parse(this.index)),this.blogData=JSON.parse(this.blogData),this.isInit=!0)}catch(e){console.warn("ghostHunter: retrieve from localStorage failed: "+e)}}if(this.isInit){var params={limit:"all",filter:"updated_at:>'"+this.latestPost.replace(/\..*/,"").replace(/T/," ")+"'",fields:"id"},ghost_root,url=(ghost_root_url||"/ghost/api/v2")+"/content/posts/?key="+ghosthunter_key+"&limit=all&fields=id&filter=updated_at:>'"+this.latestPost.replace(/\..*/,"").replace(/T/," ")+"'",me=this;$.get(url).done((function(data){data.posts.length>0?grabAndIndex.call(me):(me.indexing_end&&me.indexing_end(),me.isInit=!0)}))}else grabAndIndex.call(this)},find:function(value){clearTimeout(lastTimeoutID),value||(value=""),value=value.toLowerCase(),lastTimeoutID=setTimeout(function(){for(var thingsFound=[],valueSplit=value.split(/\s+/),i=0,ilen=valueSplit.length,searchResult;i<ilen;i++){var v=valueSplit[i];v&&thingsFound.push(this.index.query((function(q){q.term(v,{usePipeline:!0,boost:100}),q.term(v,{usePipeline:!1,boost:10,wildcard:lunr.Query.wildcard.TRAILING}),q.term(v,{usePipeline:!1,editDistance:1,boost:1})})))}if(thingsFound.length>1){var searchResult=thingsFound[0];thingsFound=thingsFound.slice(1);for(var i=searchResult.length-1;i>-1;i--){var ref=searchResult[i].ref;for(j=0,jlen=thingsFound.length;j<jlen;j++){for(var otherRefs={},k=0,klen=thingsFound[j].length;k<klen;k++)otherRefs[thingsFound[j][k].ref]=!0;if(!otherRefs[ref]){searchResult=searchResult.slice(0,i).concat(searchResult.slice(i+1));break}}}}else searchResult=1===thingsFound.length?thingsFound[0]:[];var results=$(this.results),resultsData=[];0===searchResult.length?(results.empty(),this.displaySearchInfo&&this.zeroResultsInfo&&results.append(this.format(this.info_template,{amount:0}))):this.displaySearchInfo&&(results.length>0?results.children().eq(0).replaceWith(this.format(this.info_template,{amount:searchResult.length})):results.append(this.format(this.info_template,{amount:searchResult.length}))),this.before&&this.before();for(var i=0;i<searchResult.length;i++){var lunrref=searchResult[i].ref,postData=this.blogData[lunrref];postData?(postData.ref=lunrref,resultsData.push(postData)):console.warn("ghostHunter: index/data mismatch. Ouch.")}var listItems=$(".gh-search-item"),currentRefs=listItems.map((function(){return this.id.slice(3)})).get();if(0===currentRefs.length){for(var i=0,ilen=resultsData.length;i<ilen;i++)results.append(this.format(this.result_template,resultsData[i]));settleIDs()}else{for(var newRefs=[],i=0,ilen=searchResult.length;i<ilen;i++)newRefs.push(searchResult[i].ref);var levenshtein,steps=new Levenshtein(currentRefs,newRefs).getSteps();updateSearchList.call(this,listItems,searchResult,steps)}this.onComplete&&this.onComplete(resultsData)}.bind(this),100)},clear:function(){$(this.results).empty(),this.target.val("")},format:function(t,d){return t.replace(/{{([^{}]*)}}/g,(function(a,b){var r=d[b];return"string"==typeof r||"number"==typeof r?r:a}))}};$.fn.ghostHunter=function(options){var opts=$.extend({},$.fn.ghostHunter.defaults,options);if(opts.results)return pluginMethods.init(this,opts),pluginMethods},$.fn.ghostHunter.defaults={resultsData:!1,onPageLoad:!1,onKeyUp:!1,result_template:"<a href='{{link}}'><p><h2>{{title}}</h2><h4>{{prettyPubDate}}</h4></p></a>",info_template:"<p>Number of posts found: {{amount}}</p>",displaySearchInfo:!0,zeroResultsInfo:!0,before:!1,onComplete:!1,includepages:!1,filterfields:!1};var prettyDate=function(date){var d=new Date(date),monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];return d.getDate()+" "+monthNames[d.getMonth()]+" "+d.getFullYear()},pluginMethods={isInit:!1,init:function(target,opts){var that=this;this.target=target,this.results=opts.results,this.blogData={},this.result_template=opts.result_template,this.info_template=opts.info_template,this.zeroResultsInfo=opts.zeroResultsInfo,this.displaySearchInfo=opts.displaySearchInfo,this.before=opts.before,this.onComplete=opts.onComplete,this.includepages=opts.includepages,this.filterfields=opts.filterfields,this.index=lunr((function(){this.field("title",{boost:10}),this.field("description"),this.field("link"),this.field("pubDate"),this.field("tag"),this.ref("id")})),this.index_tags=lunr((function(){this.field("name",{boost:10}),this.field("slug"),this.ref("id")})),this.index_users=lunr((function(){this.field("name",{boost:10}),this.field("slug"),this.ref("id")})),opts.onPageLoad?that.loadAPI():target.focus((function(){that.loadAPI()})),target.closest("form").submit((function(e){e.preventDefault(),that.find(target.val())})),opts.onKeyUp&&target.keyup((function(){target.val().length>2&&(that.find(target.val()),that.find_tags(target))}))},loadAPI:function(){if(this.isInit)return!1;var index=this.index,blogData=this.blogData;obj={limit:"all",include:"tags",order:"published_at DESC"},this.includepages&&(obj.filter="(page:true,page:false)"),api.posts.browse(obj).then(data=>{var domain=location.protocol+"//"+location.host;data.forEach((function(arrayItem){var tag_arr=arrayItem.tags.map((function(v){return v.name}));null==arrayItem.meta_description&&(arrayItem.meta_description="");var category=tag_arr.join(", ");category.length<1&&(category="undefined");var parsedData={id:String(arrayItem.id),title:String(arrayItem.title),description:String(arrayItem.meta_description),pubDate:String(arrayItem.created_at),image:null==arrayItem.feature_image?domain+"/assets/images/ippon-bkr.png":String(arrayItem.feature_image),tag:category,link:String(arrayItem.url)};parsedData.prettyPubDate=prettyDate(parsedData.pubDate);var tempdate=prettyDate(parsedData.pubDate);index.add(parsedData),blogData[arrayItem.id]={title:arrayItem.title,description:arrayItem.meta_description,pubDate:tempdate,image:null==arrayItem.feature_image?domain+"/assets/images/ippon-bkr.png":String(arrayItem.feature_image),link:arrayItem.url,tag:category}}))}),this.isInit=!0},find:function(value){var searchResult=this.index.search(value),results=$(this.results),resultsData=[];results.empty(),(this.zeroResultsInfo||searchResult.length>0)&&this.displaySearchInfo&&$(".info_search").empty().append(this.format(this.info_template,{amount:searchResult.length}));for(var i=0;i<searchResult.length;i++){var lunrref=searchResult[i].ref,postData=this.blogData[lunrref];i<6&&results.append(this.format(this.result_template,postData)),resultsData.push(postData)}sessionStorage.setItem("search",JSON.stringify(resultsData)),this.before&&this.before(resultsData),this.onComplete&&this.onComplete(resultsData)},clear:function(){$(this.results).empty(),this.target.val("")},format:function(t,d){return t.replace(/{{([^{}]*)}}/g,(function(a,b){var r=d[b];return"string"==typeof r||"number"==typeof r?r:a}))},find_tags:function(target){this.isInit=!0,$(".search_tag ul").empty();var index=this.index_tags,blogDataTag=[];api.tags.browse({limit:"all",include:"tags,authors,count.posts",order:"count.posts DESC"}).then(data=>{data.forEach((function(arrayItem){var parsedData={id:String(arrayItem.id),name:String(arrayItem.name),slug:String(arrayItem.slug),created_at:String(arrayItem.created_at)};index.add(parsedData),blogDataTag[arrayItem.id]={name:arrayItem.name,slug:arrayItem.slug}}));var searchResult=index.search(target.val()),searchResult_slice=searchResult.slice(0,4);0==searchResult.length?$(".search_tag").css("display","none"):$(".search_tag").css("display","block"),$(".search_tag ul").empty().append($.map(searchResult_slice,(function(value,index){var lunrref=value.ref,postData=blogDataTag[lunrref];return"<li><a href='../../tag/"+postData.slug+"'>"+postData.name+"</a></li>"})).join(" "))})}};$("#search-input").ghostHunter({results:"#popover-content .search_post",zeroResultsInfo:!1,before:function(result){$(".search_tag ul").empty(),0==result.length?$(".post_zone").css("display","none"):$(".post_zone").css("display","block")},onKeyUp:!0,zeroResultsInfo:!0,info_template:"Number of posts found: {{amount}}",result_template:'<li><img src="{{image}}" alt=""><a href="{{link}}">{{title}}</a></li>'})}(jQuery);